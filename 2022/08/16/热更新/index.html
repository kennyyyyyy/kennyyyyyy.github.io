<!DOCTYPE html>
<html lang="zh-CN">
    <head>
  <!-- 元数据 -->
  <meta charset="utf-8">
  <link rel="icon" href="/images/logo.jpg">
  <title>热更新（XLua框架） | Imperio</title>
  <meta name="author" content="kennyyy" />
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="robots" content="index,follow" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="format-detection" content="telphone=no, email=no" />
  
    <meta name="keywords" content="C#, Lua, Unity, xlua" />
  
  <meta name="description" content="资源目录划分 框架内容 Lua  UI  实体（模型，特效）  场景  声音  网络  事件  对象池   框架开发流程第一阶段：Bundle处理 构建  查找BuildResources下的资源文件  使用Unity提供的BuildPipeline进行构建  meta文件不需要打入bundle包  Bundle Build策略  按文件夹打包 ：每一个最小文件夹打包 bundle数量少，小包">
<meta property="og:type" content="article">
<meta property="og:title" content="热更新（XLua框架）">
<meta property="og:url" content="http://kennyyyyyy.github.io/2022/08/16/%E7%83%AD%E6%9B%B4%E6%96%B0/index.html">
<meta property="og:site_name" content="Imperio">
<meta property="og:description" content="资源目录划分 框架内容 Lua  UI  实体（模型，特效）  场景  声音  网络  事件  对象池   框架开发流程第一阶段：Bundle处理 构建  查找BuildResources下的资源文件  使用Unity提供的BuildPipeline进行构建  meta文件不需要打入bundle包  Bundle Build策略  按文件夹打包 ：每一个最小文件夹打包 bundle数量少，小包">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://kennyyyyyy.github.io/images/logo.jpg">
<meta property="article:published_time" content="2022-08-16T01:41:04.000Z">
<meta property="article:modified_time" content="2023-02-09T10:42:11.880Z">
<meta property="article:author" content="kennyyy">
<meta property="article:tag" content="Unity">
<meta property="article:tag" content="Lua">
<meta property="article:tag" content="C#">
<meta property="article:tag" content="xlua">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://kennyyyyyy.github.io/images/logo.jpg">
<meta name="twitter:site" content="@null">
  
  <!-- 站点验证相关 -->
  
    
    
    
  
  <!-- 样式表文件 -->
  <link rel="stylesheet" id="kratos-css" href="/css/kratosr.min.css" type="text/css" media="all">
  
    <link rel="stylesheet" id="highlight-css" href="/css/highlight/night-eighties.min.css" type="text/css" media="all">
  
  
  <link rel="stylesheet" id="fontawe-css" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" type="text/css" media="all">
  <link rel="stylesheet" id="nprogress-css" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" type="text/css" media="all">
  
  
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">
  
  
    <link rel="stylesheet" id="darkmode-css" href="/css/kr-dark.min.css" type="text/css" media="all">
  
  <!-- 不得不预先加载的一些JS文件 -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  
    <script src="https://cdn.jsdelivr.net/npm/qrcode_js@1.0.0/qrcode.min.js"></script>
  
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Imperio" type="application/atom+xml">
</head>


    <body class="custom-background">
        <div id="kratos-wrapper">
    <div id="kratos-page">
        <div id="kratos-header">
            <div class="nav-toggle"><a class="kratos-nav-toggle js-kratos-nav-toggle"><i></i></a></div>
            <header id="kratos-header-section">
                <div class="container">
                    <div class="nav-header">
                        <div class="color-logo"><a href="/">Imperio</a></div>
                        <nav id="kratos-menu-wrap">
                            <ul id="kratos-primary-menu" class="sf-menu">
                                
                                    
                                        <li><a href="/"><i class="fa fa-home"></i>首页</a></li>
                                    
                                
                                    
                                        <li><a href="/archives/"><i class="fa fa-file"></i>档案馆</a></li>
                                    
                                
                                    
                                        <li>
                                            <a><i class="fa fa-link"></i>链接</a>
                                            <ul class="sub-menu">
                                                
                                                    
                                                
                                                    
                                                        <li><a target="_blank" rel="noopener" href="https://imperio.cn">作者</a></li>
                                                    
                                                
                                                    
                                                        <li><a target="_blank" rel="noopener" href="https://github.com/kennyyyyyy/kennyyyyyy.github.io">链接</a></li>
                                                    
                                                
                                            </ul>
                                        </li>
                                    
                                
                            </ul>
                        </nav>
                    </div>
                </div>
            </header>
        </div>
        <div class="kratos-start kratos-hero-2">
            <!-- <div class="kratos-overlay"></div> -->
            <div class="kratos-cover kratos-cover-2 text-center">
                <div class="desc desc2 animate-box">
                    <a href="/">
                        <h2>Imperio</h2> <br />
                        <span>Boy♂ Next♂ Door~</span>
                    </a>
                </div>
            </div>
        </div>

        <div id="kratos-blog-post">
            <div class="container">
                <div id="main" class="row">
                    

        <section class="col-md-8">
    <article>
        <div class="kratos-hentry kratos-post-inner clearfix">
            <header class="kratos-entry-header">
                <h1 class="kratos-entry-title text-center">热更新（XLua框架）</h1>
                
                <ul class="kratos-post-meta text-center">
                    <li><i class="fa fa-calendar"></i> 2022-08-16</li>
                    <li><i class="fa fa-user"></i> 作者 kennyyy</li>
                    <li>
                        <i class="fa fa-edit"></i> 
                        
                        
                            ~18.44K
                        
                        字
                    </li>
                    
                </ul>
            </header>
            <div class="kratos-post-content">
                <div id="expire-alert" class="alert alert-warning hidden" role="alert">
                    本文最后编辑于 <time datetime="1675939331880"></time> 前，其中的内容可能需要更新。
                </div>
                
                    <div class="kratos-post-inner-toc">
                        <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E7%9B%AE%E5%BD%95%E5%88%92%E5%88%86"><span class="toc-number">1.</span> <span class="toc-text">资源目录划分</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%86%E6%9E%B6%E5%86%85%E5%AE%B9"><span class="toc-number">2.</span> <span class="toc-text">框架内容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%86%E6%9E%B6%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B"><span class="toc-number">3.</span> <span class="toc-text">框架开发流程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5%EF%BC%9ABundle%E5%A4%84%E7%90%86"><span class="toc-number">3.1.</span> <span class="toc-text">第一阶段：Bundle处理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5%EF%BC%9AC-%E8%B0%83%E7%94%A8Lua"><span class="toc-number">3.2.</span> <span class="toc-text">第二阶段：C#调用Lua</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5%EF%BC%9A%E5%90%91Lua%E6%8F%90%E4%BE%9B%E6%8E%A5%E5%8F%A3"><span class="toc-number">3.3.</span> <span class="toc-text">第三阶段：向Lua提供接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E9%98%B6%E6%AE%B5%EF%BC%9A%E5%AE%8C%E5%96%84%E5%92%8C%E4%BC%98%E5%8C%96"><span class="toc-number">3.4.</span> <span class="toc-text">第四阶段：完善和优化</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#UI%E7%AE%A1%E7%90%86"><span class="toc-number">3.5.</span> <span class="toc-text">UI管理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9E%E4%BD%93%E7%AE%A1%E7%90%86"><span class="toc-number">3.6.</span> <span class="toc-text">实体管理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF%E7%AE%A1%E7%90%86"><span class="toc-number">3.7.</span> <span class="toc-text">场景管理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A3%B0%E9%9F%B3%E7%AE%A1%E7%90%86"><span class="toc-number">3.8.</span> <span class="toc-text">声音管理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E7%AE%A1%E7%90%86"><span class="toc-number">3.9.</span> <span class="toc-text">事件管理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E6%B1%A0%E8%AE%BE%E8%AE%A1"><span class="toc-number">3.10.</span> <span class="toc-text">对象池设计</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9D%97"><span class="toc-number">3.11.</span> <span class="toc-text">网络模块</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%83%AD%E6%9B%B4%E6%96%B0%E6%A1%86%E6%9E%B6"><span class="toc-number">4.</span> <span class="toc-text">热更新框架</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E6%9B%B4%E6%96%B0"><span class="toc-number">4.1.</span> <span class="toc-text">为什么需要更新</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%83%AD%E6%9B%B4%E6%96%B0%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">4.2.</span> <span class="toc-text">热更新是什么</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Lua%E7%83%AD%E6%9B%B4%E7%9A%84%E5%87%A0%E4%B8%AA%E7%82%B9"><span class="toc-number">4.2.1.</span> <span class="toc-text">Lua热更的几个点</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Xlua%E6%A1%86%E6%9E%B6%E4%B8%8E%E9%A1%B9%E7%9B%AE%E6%A1%86%E6%9E%B6"><span class="toc-number">4.3.</span> <span class="toc-text">Xlua框架与项目框架</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#lua%E6%A1%86%E6%9E%B6%E2%80%94%E4%B8%BB%E7%A8%8B%E6%89%80%E8%80%83%E8%99%91%E7%9A%84"><span class="toc-number">4.3.1.</span> <span class="toc-text">lua框架—主程所考虑的</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%AD%E5%90%8E%E6%9C%9F%E9%A1%B9%E7%9B%AE%E7%9A%84%E7%83%AD%E6%9B%B4%E9%87%8D%E6%9E%84%E5%BB%BA%E8%AE%AE"><span class="toc-number">4.3.2.</span> <span class="toc-text">中后期项目的热更重构建议</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#XLua%E6%A1%86%E6%9E%B6"><span class="toc-number">4.3.3.</span> <span class="toc-text">XLua框架</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%86%E6%9E%B6%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD"><span class="toc-number">4.4.</span> <span class="toc-text">框架基本功能</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E5%88%92%E5%88%86"><span class="toc-number">4.4.1.</span> <span class="toc-text">资源目录结构划分</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97%E7%9A%84%E5%BC%95%E7%94%A8%E4%B8%8E%E6%93%8D%E4%BD%9C"><span class="toc-number">4.4.2.</span> <span class="toc-text">功能模块的引用与操作</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">4.4.3.</span> <span class="toc-text">配置文件的使用</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E4%B8%8E%E9%A2%84%E5%88%B6%E4%BD%93%E8%B5%84%E6%BA%90%E7%9A%84%E5%8A%A8%E6%80%81%E8%8E%B7%E5%8F%96"><span class="toc-number">4.4.4.</span> <span class="toc-text">图片与预制体资源的动态获取</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8D%95%E6%9C%BADemo%E7%83%AD%E6%9B%B4%E6%96%B0%E5%88%B6%E4%BD%9C%E8%A7%84%E5%88%92"><span class="toc-number">4.4.5.</span> <span class="toc-text">单机Demo热更新制作规划</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%88%98%E6%96%97%E7%B3%BB%E7%BB%9F%E5%88%86%E6%9E%90"><span class="toc-number">4.5.</span> <span class="toc-text">战斗系统分析</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BD%91%E6%B8%B8%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97%E5%88%86%E6%9E%90"><span class="toc-number">4.6.</span> <span class="toc-text">网游功能模块分析</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9D%97%E5%88%86%E6%9E%90"><span class="toc-number">4.6.1.</span> <span class="toc-text">网络模块分析</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%80%E6%AC%A1%E4%B8%9A%E5%8A%A1%E8%AF%B7%E6%B1%82%E9%80%BB%E8%BE%91%E6%B5%81%E7%A8%8B"><span class="toc-number">4.6.2.</span> <span class="toc-text">一次业务请求逻辑流程</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%83%8C%E5%8C%85%E6%A8%A1%E5%9D%97%E5%88%86%E6%9E%90"><span class="toc-number">4.6.3.</span> <span class="toc-text">背包模块分析</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">4.6.4.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%86%E6%9E%B6%E6%A6%82%E5%BF%B5"><span class="toc-number">4.7.</span> <span class="toc-text">框架概念</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%A1%86%E6%9E%B6%E7%9B%AE%E6%A0%87"><span class="toc-number">4.7.1.</span> <span class="toc-text">框架目标</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E7%83%AD%E6%9B%B4%E6%A1%86%E6%9E%B6"><span class="toc-number">4.7.2.</span> <span class="toc-text">为什么需要热更框架</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%83%AD%E6%9B%B4%E6%A1%86%E6%9E%B6%E7%9B%AE%E6%A0%87"><span class="toc-number">4.7.3.</span> <span class="toc-text">热更框架目标</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%86%E6%9E%B6%E7%BB%93%E6%9E%84"><span class="toc-number">4.8.</span> <span class="toc-text">框架结构</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%A1%86%E6%9E%B6%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">4.8.1.</span> <span class="toc-text">框架项目目录结构</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%87%8D%E7%82%B9%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97"><span class="toc-number">4.8.2.</span> <span class="toc-text">重点功能模块</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97%E8%B0%83%E7%94%A8%E5%85%B3%E7%B3%BB"><span class="toc-number">4.8.3.</span> <span class="toc-text">功能模块调用关系</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%86%E6%9E%B6%E5%8A%9F%E8%83%BD%E8%AE%BE%E8%AE%A1"><span class="toc-number">4.9.</span> <span class="toc-text">框架功能设计</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E6%89%93%E5%8C%85%E7%AD%96%E7%95%A5"><span class="toc-number">4.10.</span> <span class="toc-text">资源打包策略</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E7%AD%96%E7%95%A5"><span class="toc-number">4.11.</span> <span class="toc-text">资源管理策略</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E8%AE%BE%E8%AE%A1"><span class="toc-number">4.12.</span> <span class="toc-text">开发工具设计</span></a></li></ol></li></ol>
                    </div>
                
                <hr />
                <span id="more"></span>
<hr>
<h4 id="资源目录划分"><a href="#资源目录划分" class="headerlink" title="资源目录划分"></a>资源目录划分</h4><p><img src="/images/热更新/资源目录划分.png" alt="image-20221105153329320"></p>
<h4 id="框架内容"><a href="#框架内容" class="headerlink" title="框架内容"></a>框架内容</h4><ul>
<li><p>Lua</p>
</li>
<li><p>UI</p>
</li>
<li><p>实体（模型，特效）</p>
</li>
<li><p>场景</p>
</li>
<li><p>声音</p>
</li>
<li><p>网络</p>
</li>
<li><p>事件</p>
</li>
<li><p>对象池</p>
</li>
</ul>
<h4 id="框架开发流程"><a href="#框架开发流程" class="headerlink" title="框架开发流程"></a>框架开发流程</h4><h5 id="第一阶段：Bundle处理"><a href="#第一阶段：Bundle处理" class="headerlink" title="第一阶段：Bundle处理"></a>第一阶段：Bundle处理</h5><ul>
<li><p>构建</p>
<ul>
<li><p>查找BuildResources下的资源文件</p>
</li>
<li><p>使用Unity提供的BuildPipeline进行构建</p>
</li>
<li><p>meta文件不需要打入bundle包</p>
</li>
<li><p>Bundle Build策略</p>
<ul>
<li>按文件夹打包 ：每一个最小文件夹打包<ul>
<li>bundle数量少，小包模式：首次下载块</li>
<li>后期更新补丁大</li>
</ul>
</li>
<li>按文件打包：每一个文件一个包<ul>
<li>更新补丁很小</li>
<li>小包模式下：首次下载较慢 </li>
</ul>
</li>
</ul>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// buildTarget:构建目标平台</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Build</span>(<span class="params">BuildTarget buildTarget</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    List&lt;AssetBundleBuild&gt; assetBundleBuilds = <span class="keyword">new</span> List&lt;AssetBundleBuild&gt;();    </span><br><span class="line">	<span class="comment">//查找目标文件夹下的所有文件</span></span><br><span class="line">    <span class="built_in">string</span>[] files = Directory.GetFiles(PathUtil.BuildResourcesPath, <span class="string">&quot;*&quot;</span>, SearchOption.AllDirectories);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span>(<span class="keyword">var</span> file <span class="keyword">in</span> files)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//排除meta文件</span></span><br><span class="line">        <span class="keyword">if</span> (file.EndsWith(<span class="string">&quot;meta&quot;</span>))</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        AssetBundleBuild assetBundle = <span class="keyword">new</span> AssetBundleBuild();</span><br><span class="line">		</span><br><span class="line">        <span class="built_in">string</span> path = PathUtil.GetStandardPath(file);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">string</span> assetName = PathUtil.GetUnityPath(path);</span><br><span class="line">        <span class="built_in">string</span> bundleName = path.Replace(PathUtil.BuildResourcesPath, <span class="string">&quot;&quot;</span>);</span><br><span class="line">		<span class="comment">//设置资源名字和包的名字，包的名字路径需要为相对路径</span></span><br><span class="line">        assetBundle.assetNames = <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; assetName &#125;;</span><br><span class="line">        assetBundle.assetBundleName = bundleName + <span class="string">&quot;.ab&quot;</span>;</span><br><span class="line">		</span><br><span class="line">        assetBundleBuilds.Add(assetBundle);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(Directory.Exists(PathUtil.BuildOutPath))</span><br><span class="line">        Directory.Delete(PathUtil.BuildOutPath, <span class="literal">true</span>);</span><br><span class="line">    Directory.CreateDirectory(PathUtil.BuildOutPath);</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//使用Buildpeline导出bundle包</span></span><br><span class="line">    BuildPipeline.BuildAssetBundles(PathUtil.BuildOutPath, assetBundleBuilds.ToArray(), BuildAssetBundleOptions.None, buildTarget);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>加载</p>
<ul>
<li><p>加载对应的包，然后实例化</p>
<ul>
<li><p>代码为从文件中异步加载</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//加载一个预制体需要加载其依赖资源</span></span><br><span class="line"><span class="function">IEnumerator <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//加载预制体ab包</span></span><br><span class="line">    AssetBundleCreateRequest assetBundleCreateRequest = AssetBundle.LoadFromFileAsync(PathUtil.BuildOutPath + <span class="string">&quot;/prefab/testbutton.prefab.ab&quot;</span>);</span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">return</span> assetBundleCreateRequest;</span><br><span class="line">    <span class="comment">//加载素材ab包</span></span><br><span class="line">    AssetBundleCreateRequest assetBundleCreateRequest1 = AssetBundle.LoadFromFileAsync(PathUtil.BuildOutPath + <span class="string">&quot;/ui/background.png.ab&quot;</span>);</span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">return</span> assetBundleCreateRequest1;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//加载对应预制体</span></span><br><span class="line">    AssetBundleRequest assetBundleRequest = assetBundleCreateRequest.assetBundle.LoadAssetAsync(PathUtil.GetUnityPath(PathUtil.BuildResourcesPath + <span class="string">&quot;Prefab/TestButton.prefab&quot;</span>));</span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">return</span> assetBundleRequest;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//实例化</span></span><br><span class="line">    GameObject go = Instantiate(assetBundleRequest.asset) <span class="keyword">as</span> GameObject;</span><br><span class="line">    go.transform.SetParent(transform);</span><br><span class="line">    go.SetActive(<span class="literal">true</span>);</span><br><span class="line">    go.transform.localPosition = Vector3.zero;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>实际过程中不可能查看预制体来知晓依赖文件，因此需要用一个文件来对依赖文件信息进行存储。即版本文件，文件信息为：文件路径名|bundle名|依赖文件列表。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 获取文件的依赖文件列表</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;curFile&quot;&gt;</span>当前文件<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;<span class="built_in">string</span>&gt; <span class="title">GetDependence</span>(<span class="params"><span class="built_in">string</span> curFile</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    List&lt;<span class="built_in">string</span>&gt; dependence = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;();</span><br><span class="line">    <span class="built_in">string</span>[] files = AssetDatabase.GetDependencies(curFile);</span><br><span class="line">    dependence = files.Where(file =&gt; !file.EndsWith(<span class="string">&quot;.cs&quot;</span>) &amp;&amp; !file.Equals(curFile)).ToList();</span><br><span class="line">    <span class="keyword">return</span> dependence;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在打包时对依赖文件路径进行记录</span></span><br><span class="line">List&lt;<span class="built_in">string</span>&gt; bundleInfos = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;();</span><br><span class="line">List&lt;<span class="built_in">string</span>&gt; dependenceInfo = GetDependence(assetName);</span><br><span class="line"><span class="built_in">string</span> bundleInfo = assetName + <span class="string">&quot;|&quot;</span> + bundleName + <span class="string">&quot;.ab&quot;</span>; </span><br><span class="line"><span class="keyword">if</span>(dependenceInfo.Count &gt; <span class="number">0</span>)</span><br><span class="line">    bundleInfo = bundleInfo + <span class="string">&quot;|&quot;</span> + <span class="built_in">string</span>.Join(<span class="string">&quot;|&quot;</span>, dependenceInfo);</span><br><span class="line">bundleInfos.Add(bundleInfo);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>解析版本文件，加载依赖，加载自身，加载资源</p>
<p><img src="/images/热更新/image-20221106183101232.png" alt="资源加载流程"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 异步加载资源</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 读取字典中存储的依赖资源路径</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 递归加载所有依赖资源，当所有以来资源加载完之后加载自身</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> TODO：需要解决重复加载bundle包的问题，且对于场景，不需要对资源惊醒加载</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 最后回调</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;assetName&quot;&gt;</span>资源名<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;action&quot;&gt;</span>完成加载后的回调<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function">IEnumerator <span class="title">LoadBundleAsync</span>(<span class="params"><span class="built_in">string</span> assetName, Action&lt;Object&gt; action = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">string</span> bundleName = BundleInfosDic[assetName].BundleName;</span><br><span class="line">    <span class="built_in">string</span> bundlePath = Path.Combine(PathUtil.BundleResourcePath, bundleName);</span><br><span class="line">    List&lt;<span class="built_in">string</span>&gt; dependences = BundleInfosDic[assetName].Dependences;</span><br><span class="line">    <span class="keyword">if</span>(dependences != <span class="literal">null</span> &amp;&amp; dependences.Count &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; dependences.Count; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="function"><span class="keyword">yield</span> <span class="keyword">return</span> <span class="title">LoadBundleAsync</span>(<span class="params">dependences[i]</span>)</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    AssetBundleCreateRequest assetBundleCreateRequest = AssetBundle.LoadFromFileAsync(bundlePath);</span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">return</span> assetBundleCreateRequest;</span><br><span class="line"></span><br><span class="line">    AssetBundleRequest assetBundleRequest = assetBundleCreateRequest.assetBundle.LoadAssetAsync(assetName);</span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">return</span> assetBundleRequest;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//问号判断前面的变量是否为空</span></span><br><span class="line">    action?.Invoke(assetBundleRequest?.asset);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>开放接口，方便用户调用</p>
<p><img src="/images/热更新/image-20221106235358622.png" alt="PathUtil路径接口"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> AssetType</span><br><span class="line">&#123;</span><br><span class="line">    Lua,</span><br><span class="line">    Music,</span><br><span class="line">    Sound,</span><br><span class="line">    Effect,</span><br><span class="line">    UI,</span><br><span class="line">    Sprite,</span><br><span class="line">    Scene</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">LoadAsset</span>(<span class="params">AssetType assetType, <span class="built_in">string</span> assetName, Action&lt;Object&gt; action</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (assetType)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> AssetType.Lua:</span><br><span class="line">            LoadAsset(PathUtil.GetLuaPath(assetName), action);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> AssetType.Music:</span><br><span class="line">            LoadAsset(PathUtil.GetMusicPath(assetName), action);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> AssetType.Sound:</span><br><span class="line">            LoadAsset(PathUtil.GetSoundPath(assetName), action);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> AssetType.Effect:</span><br><span class="line">            LoadAsset(PathUtil.GetEffectPath(assetName), action);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> AssetType.UI:</span><br><span class="line">            LoadAsset(PathUtil.GetUIPath(assetName), action);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> AssetType.Sprite:</span><br><span class="line">            LoadAsset(PathUtil.GetSpritePath(assetName), action);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> AssetType.Scene:</span><br><span class="line">            LoadAsset(PathUtil.GetScenePath(assetName), action);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="literal">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>更新</p>
<ul>
<li><p>热更新方案</p>
<ul>
<li>整包 <ul>
<li>策略：完整更新资源放在包内</li>
<li>优点：首次更新少</li>
<li>缺点：安装包下载时间长，首次安装久</li>
</ul>
</li>
<li>分包<ul>
<li>策略：包内放少量或不妨更新资源</li>
<li>优点：安装包小，下载快，安装块</li>
<li>缺点：首次更新时间久</li>
</ul>
</li>
</ul>
</li>
<li><p>热更资源流程</p>
<ul>
<li><p>Application.streamingAssets：只读</p>
</li>
<li><p>Application.persisitentDataPath：可写    </p>
<p><img src="/images/热更新/image-20221107123701894.png" alt="热更资源流程"></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>热更新代码流程</p>
<ul>
<li><p>下载文件</p>
</li>
<li><p>写入文件</p>
</li>
<li><p>解析filelist</p>
<p><img src="/images/热更新/image-20221107124643590.png" alt="热更代码流程"> </p>
</li>
</ul>
</li>
<li><p>检测初次安装</p>
<ul>
<li>只读目录有热更资源</li>
<li>可读写目录没有热更资源</li>
<li>判断filelist文件是否存在</li>
<li>最后写入filelist</li>
</ul>
</li>
<li><p>检查更新</p>
<ul>
<li>下载资源服务器上的filelist文件</li>
<li>对比文件信息和本地是否一致</li>
</ul>
</li>
<li><p>文件路径</p>
<ul>
<li>只读目录：Application.streamingAssetsPath/ + path</li>
<li>可读写目录：Application.persistentDataPath/ + path</li>
<li>资源服务器地址：<a target="_blank" rel="noopener" href="http://127.0.0.1/AssetBundles/">http://127.0.0.1/AssetBundles/</a> + path</li>
</ul>
</li>
</ul>
<h5 id="第二阶段：C-调用Lua"><a href="#第二阶段：C-调用Lua" class="headerlink" title="第二阶段：C#调用Lua"></a>第二阶段：C#调用Lua</h5><ul>
<li><p>Lua加载与管理</p>
<ul>
<li><p>Lua文件加载</p>
<ol>
<li><p>执行字符串：直接使用<strong>DoString</strong>执行一个字符串</p>
<p><code>luaenv.DoString(“print(‘hello world’)”)</code></p>
</li>
<li><p>加载Lua文件：使用lua的require函数，lua文件需要在Resource路径下，或者需要绝对路径</p>
<p><code>DoString(“require ‘byfile’”);</code></p>
</li>
<li><p>自定义Loader</p>
<p>涉及一个接口</p>
<p><code>public delegate byte[] CustomLoader(ref string filepath);</code></p>
<p><code>public void LuaEnv.AddLoader(CustomLoader loader);</code></p>
<p>filepath为文件路径，返回值是lua文件的内容</p>
</li>
</ol>
</li>
<li><p>Lua文件管理</p>
<ol>
<li>异步加载</li>
<li>同步使用</li>
<li>预加载</li>
</ol>
</li>
<li><p>C#访问LUA</p>
<p><code>luaenv.Global.Get&lt;int&gt;(&quot;a&quot;)</code></p>
<p><code>luaenv.Global.Get&lt;string&gt;(&quot;b&quot;)</code></p>
<p><code>luaenv.Global.Get&lt;bool&gt;(&quot;c&quot;)</code></p>
</li>
</ul>
</li>
<li><p>Lua绑定与执行</p>
<ul>
<li><p>绑定：XLua插件的案例2为例</p>
<p><img src="/images/热更新/image-20221108162213528.png" alt="C#绑定lua脚本流程"></p>
<p>绑定脚本和方法后，可以在C#中进行lua方法的调用</p>
<p>结束运行前需要取消绑定</p>
</li>
<li><p>执行</p>
<ul>
<li><p>Lua中调用C#代码</p>
<p>所有的类和命名空间都在CS命名空间下，方法通过 ‘ : ‘ 调用</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Manager = CS.FrameWork.Managers.Manager</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">    Manager.UIManager:OpenUI(<span class="string">&quot;TestButton&quot;</span>, <span class="string">&quot;UI/UITest&quot;</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="第三阶段：向Lua提供接口"><a href="#第三阶段：向Lua提供接口" class="headerlink" title="第三阶段：向Lua提供接口"></a>第三阶段：向Lua提供接口</h5><h5 id="第四阶段：完善和优化"><a href="#第四阶段：完善和优化" class="headerlink" title="第四阶段：完善和优化"></a>第四阶段：完善和优化</h5><h5 id="UI管理"><a href="#UI管理" class="headerlink" title="UI管理"></a>UI管理</h5><ul>
<li><p>界面类型</p>
<ul>
<li><p>一极界面</p>
</li>
<li><p>二级弹窗</p>
</li>
<li><p>三级弹窗</p>
</li>
<li><p>特殊界面</p>
</li>
</ul>
</li>
<li><p>UGUI层级特点</p>
<ul>
<li>根据节点顺序渲染</li>
</ul>
</li>
</ul>
<p>为了解决UI的层级显示问题，根据Unity中的ui渲染顺序，可以设置多个父节点来对所有的UI进行一个分类的管理。每一个层级对应一个父节点。</p>
<p><img src="/images/热更新/image-20221111130852713.png" alt="UI层级示例"></p>
<ul>
<li><p>UI的层级设置应该放在lua热更中，方便之后对ui层级的添加和修改</p>
<ul>
<li><p>UIManger中提供设置层级的方法供lua调用</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetUIGroup</span>(<span class="params">List&lt;<span class="built_in">string</span>&gt; groupNames</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="built_in">string</span> groupName <span class="keyword">in</span> groupNames)</span><br><span class="line">    &#123;</span><br><span class="line">		<span class="comment">//实例化所有节点</span></span><br><span class="line">        <span class="comment">//Unity中先实例化的在上，即先渲染，因此在lua中的顺序就决定了其在unity中层级渲染顺序</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--调用c#中的方法</span></span><br><span class="line">Manager.UIManager:SetUIGroup(group);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h5 id="实体管理"><a href="#实体管理" class="headerlink" title="实体管理"></a>实体管理</h5><ul>
<li>管理方法与UI一致</li>
</ul>
<h5 id="场景管理"><a href="#场景管理" class="headerlink" title="场景管理"></a>场景管理</h5><ul>
<li><p>场景加载</p>
<p>通过协程调用SceneManager的的异步场景加载方法<code>LoadSceneAsync(name, mode);</code></p>
<p>场景不能直接添加脚本，所以在场景中添加一个物体，用于添加场景的管理脚本，并调用其相关方法。</p>
<p>为了方便，提供一个方法用于获取场景中的管理对象上的管理脚本，即查找场景中的所有物体，然后获得名字为管理对象的脚本</p>
<ul>
<li><p>场景叠加</p>
<ul>
<li>即<code>LoadSceneMode.Additive</code>模式加载场景，即打开一个新的场景至当前场景</li>
</ul>
</li>
<li><p>场景切换</p>
<ul>
<li>即<code>LoadSceneMode.Additive</code>模式加载场景，即关闭当前所有场景，打开新的场景 </li>
</ul>
</li>
<li><p>场景激活</p>
<ul>
<li><p>即<code>SetActiveScene(name)</code></p>
</li>
<li><p>场景的setActive和InActive会有相关方法调用，因此需要添加场景激活的函数回调</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//activeSceneChanged为unity提供的事件，用于场景激活后的函数回调</span></span><br><span class="line"><span class="comment">//此函数提供两个参数分别表示激活前和激活后的场景</span></span><br><span class="line">SceneManager.activeSceneChanged += OnActiveSceneChanged;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnActiveSceneChanged</span>(<span class="params">Scene s1, Scene s2</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!s1.isLoaded || !s2.isLoaded)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    SceneLogic sl1 = GetSceneLogic(s1);</span><br><span class="line">    SceneLogic sl2 = GetSceneLogic(s2); </span><br><span class="line">    sl1?.OnInActive();</span><br><span class="line">    sl2?.OnActive();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p>场景卸载</p>
<p>和加载类似，通过协程调用异步卸载场景的方法。、</p>
</li>
</ul>
<h5 id="声音管理"><a href="#声音管理" class="headerlink" title="声音管理"></a>声音管理</h5><ul>
<li><p>背景音乐</p>
<ul>
<li><p>播放</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 播放音乐，需要判断需要播放的是否是当前正在播放的</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 防止重复加载</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">PlayMusic</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (MusicVolume &lt; <span class="number">0.1f</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">string</span> oldName = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (musicAudio != <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        oldName = musicAudio.clip.name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (oldName == name)</span><br><span class="line">    &#123;</span><br><span class="line">        musicAudio.Play();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Manager.ResourceManager.LoadAsset(ResourceManager.AssetType.Music, name, (UnityEngine.Object obj) =&gt;</span><br><span class="line">                                      &#123;</span><br><span class="line">                                          musicAudio.clip = obj <span class="keyword">as</span> AudioClip;</span><br><span class="line">                                          musicAudio.Play();</span><br><span class="line">                                      &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>除播放外，其余只需要调用相关方法即可</p>
</li>
<li><p>暂停</p>
</li>
<li><p>恢复</p>
</li>
<li><p>停止</p>
</li>
<li><p>音量</p>
</li>
</ul>
</li>
<li><p>音效</p>
<ul>
<li>音量</li>
<li>播放</li>
</ul>
</li>
</ul>
<h5 id="事件管理"><a href="#事件管理" class="headerlink" title="事件管理"></a>事件管理</h5><p>时间管理可以对所有的事件进行一个统一的管理</p>
<ul>
<li>订阅</li>
<li>取消订阅</li>
<li>执行调用</li>
</ul>
<h5 id="对象池设计"><a href="#对象池设计" class="headerlink" title="对象池设计"></a>对象池设计</h5><p>对象类型</p>
<ul>
<li>AssetBundle</li>
<li>GameObject</li>
</ul>
<p>特点</p>
<p>使用自定义类，该类有上次使用时间，使用的对象和销毁的时间间隔 PoolObject</p>
<ul>
<li><p>对象池中存放多种类型</p>
<p>用一个List\<PoolObject>对所有对象进行存储</PoolObject></p>
</li>
<li><p>短时间内重复使用</p>
<p>在销毁的间隔时间内能以一直使用</p>
</li>
<li><p>过期自动销毁</p>
<p>当过了销毁时间间隔还未被使用，则将对象进行销毁</p>
</li>
</ul>
<p>设计原理：池内不创建对象，对象在外部创建，使用完放入对象池，</p>
<p>使用时再取出。即不预先创建对象，当需要时向对象池中取，池中没有则创建</p>
<ol>
<li><p>由于存在两种对象，且加载和释放的方式有不同，所以定义一个基类PoolBase和两个类继承基类</p>
</li>
<li><p>生成</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//从对象池中获得物体</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> Object <span class="title">Spwan</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> go <span class="keyword">in</span> poolObjects)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(go.name == name)</span><br><span class="line">        &#123;</span><br><span class="line">            poolObjects.Remove(go);</span><br><span class="line">            <span class="keyword">return</span> go.@object;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>回收</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">UnSpwan</span>(<span class="params"><span class="built_in">string</span> name, Object obj</span>) </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    PoolObject poolObject = <span class="keyword">new</span> PoolObject(name, obj);</span><br><span class="line">    poolObjects.Add(poolObject);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>对于AssetBundle，在游戏中可能存在多个物体对其的引用，只有当没有物体的引用时，才能将其放回对象池中。因此，可以定义一个数据结构对bundle的引用进行计数。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">BundleData</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> AssetBundle Bundle;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Count;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BundleData</span>(<span class="params">AssetBundle ab</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Bundle = ab;</span><br><span class="line">        Count = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="网络模块"><a href="#网络模块" class="headerlink" title="网络模块"></a>网络模块</h5><p>通信协议：用于服务端和客户端通信的数据格式</p>
<ul>
<li>protobuf、sproto、pbc、json等</li>
<li>xlua使用通信协议需要添加第三方库，此项目中直接使用的是<a target="_blank" rel="noopener" href="https://github.com/chexiongsheng/build_xlua_with_libs">github</a>上的编译好的库</li>
</ul>
<p>客户端C#</p>
<ul>
<li><p>NetClient：客户端的网络消息处理类</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span><span class="doctag">///</span>/</span></span><br><span class="line"><span class="comment">//主要协议相关</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span><span class="doctag">///</span>/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//缓冲区大小</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">const</span> <span class="built_in">int</span> BufferSize = <span class="number">1024</span> * <span class="number">64</span>;</span><br><span class="line"><span class="comment">//基于TCP协议的客户端协议</span></span><br><span class="line"><span class="keyword">private</span> TcpClient client;</span><br><span class="line"><span class="comment">//网络数据流，用于发送和接收数据</span></span><br><span class="line"><span class="keyword">private</span> NetworkStream tcpStream;</span><br><span class="line"><span class="comment">//缓冲区</span></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">byte</span>[] buffer = <span class="keyword">new</span> <span class="built_in">byte</span>[BufferSize];</span><br><span class="line"></span><br><span class="line"><span class="comment">//解析接收的数据</span></span><br><span class="line"><span class="keyword">private</span> MemoryStream memStream;</span><br><span class="line"><span class="keyword">private</span> BinaryReader binaryReader;</span><br><span class="line"></span><br><span class="line"><span class="comment">//开始连接</span></span><br><span class="line">client.BeginConnect(host, port, OnConnect, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//读取数据</span></span><br><span class="line">tcpStream.BeginRead(buffer, <span class="number">0</span>, BufferSize, OnRead, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//读取对应长度的字节数</span></span><br><span class="line"><span class="built_in">byte</span>[] data = binaryReader.ReadBytes(msgLen);</span><br><span class="line"></span><br><span class="line"><span class="comment">//发送数据</span></span><br><span class="line">tcpStream.BeginWrite(sendData, <span class="number">0</span>, sendData.Length, OnEndSend, <span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>NetManager：提供消息处理的中转接口，调用lua</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//消息队列，接收到消息就放入消息队列中</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">Queue</span>&lt;<span class="title">KeyValuePair</span>&lt;<span class="title">int</span>, <span class="title">string</span>&gt;&gt; messageQueue</span> = <span class="keyword">new</span> Queue&lt;KeyValuePair&lt;<span class="built_in">int</span>, <span class="built_in">string</span>&gt;&gt;();</span><br><span class="line"><span class="comment">//lua的function</span></span><br><span class="line"><span class="keyword">private</span> XLua.LuaFunction ReceiveMessage;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SendMessage</span>(<span class="params"><span class="built_in">int</span> msgID, <span class="built_in">string</span> message</span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConnectedServer</span>(<span class="params"><span class="built_in">string</span> host, <span class="built_in">int</span> port</span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnNetConneted</span>(<span class="params"></span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnDisConnected</span>(<span class="params"></span>)</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Receive</span>(<span class="params"><span class="built_in">int</span> msgID, <span class="built_in">string</span> message</span>)</span>;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>客户端Lua</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 提供一个基础类定义</span></span><br><span class="line"><span class="comment">--super 父类</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Class</span><span class="params">(super)</span></span></span><br><span class="line">    <span class="keyword">local</span> class = <span class="literal">nil</span>;</span><br><span class="line">    <span class="comment">-- 存在父类则设置原表</span></span><br><span class="line">    <span class="keyword">if</span> super <span class="keyword">then</span></span><br><span class="line">        class = <span class="built_in">setmetatable</span>(&#123;&#125;, &#123;<span class="built_in">__index</span> = super&#125;);</span><br><span class="line">        class.super = super;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="comment">--不存在则新建一个表，并有一个构造函数</span></span><br><span class="line">        class = &#123;ctor = <span class="function"><span class="keyword">function</span><span class="params">()</span></span> <span class="keyword">end</span>&#125;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    class.<span class="built_in">__index</span> = class</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 为子类提供一个new方法，用于调用构造函数</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">class.new</span><span class="params">(...)</span></span></span><br><span class="line">        <span class="keyword">local</span> instance = <span class="built_in">setmetatable</span>(&#123;&#125;, class);</span><br><span class="line">        <span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">create</span><span class="params">(inst, ...)</span></span></span><br><span class="line">            <span class="comment">-- 存在父类则递归创建构造函数</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">type</span>(inst.super) == <span class="string">&quot;table&quot;</span> <span class="keyword">then</span></span><br><span class="line">                <span class="built_in">create</span>(inst.super, ...);</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">type</span>(inst.ctor) == <span class="string">&quot;function&quot;</span> <span class="keyword">then</span></span><br><span class="line">                inst.ctor(instance, ...);</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="built_in">create</span>(instance, ...);</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> class;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>基于Class存在一个baseMessage类，存在消息注册的方法。在该模块中会存在对消息请求和接收的处理。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--消息注册</span></span><br><span class="line"><span class="comment">-- msgName 消息名称 </span></span><br><span class="line"><span class="comment">-- msgID 消息ID</span></span><br><span class="line"><span class="comment">-- ... 参数列表的Key</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">baseMessage:addReqRes</span><span class="params">(msgName, msgID, ...)</span></span></span><br><span class="line">    <span class="keyword">local</span> keys = &#123;...&#125;;</span><br><span class="line">    <span class="comment">-- 消息请求</span></span><br><span class="line">    <span class="built_in">self</span>[<span class="string">&quot;req_&quot;</span>..msgName] = <span class="function"><span class="keyword">function</span><span class="params">(self, ...)</span></span></span><br><span class="line">        <span class="keyword">local</span> values = &#123;...&#125;;</span><br><span class="line">        <span class="keyword">if</span> #keys ~= #values <span class="keyword">then</span></span><br><span class="line">            Log.Error(<span class="string">&quot;参数不正确: &quot;</span>, msgName);</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">local</span> sendData = &#123;&#125;;</span><br><span class="line">        <span class="comment">-- 将key和value对应</span></span><br><span class="line">        <span class="keyword">for</span> i = <span class="number">1</span>, #keys <span class="keyword">do</span></span><br><span class="line">            sendData[keys[i]] = values[i];</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="comment">--发送消息</span></span><br><span class="line">        msgManager.sendMsg(msgID, sendData);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">--消息接收，要先对消息接收进行注册</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span>(<span class="built_in">self</span>[<span class="string">&quot;res_&quot;</span>..msgName] == <span class="string">&quot;function&quot;</span>) <span class="keyword">then</span></span><br><span class="line">        msgManager.register(msgID, </span><br><span class="line">        <span class="comment">-- 收到消息的回调</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span><span class="params">(data)</span></span></span><br><span class="line">            <span class="keyword">local</span> msg = Json.decode(data);</span><br><span class="line">            <span class="keyword">if</span> msg.code ~= <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">                Log.Error(<span class="string">&quot;错误码：&quot;</span>, msg.code);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="built_in">self</span>[<span class="string">&quot;res_&quot;</span>..msgName](<span class="built_in">self</span>, msg);</span><br><span class="line">        <span class="keyword">end</span>)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        Log.Error(<span class="string">&quot;请注册消息返回回调：&quot;</span>..msgName);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>功能模块化</p>
<ul>
<li>消息注册</li>
<li>消息发送</li>
<li>消息接收  </li>
</ul>
</li>
<li><p>模块管理器</p>
<p>模块管理器即消息管理，在此类中保存所有的模块列表和所有的回调列表。所有的模块的名字需要手动添加</p>
<ul>
<li><p>模块化初始化</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 遍历名字列表msgNameList，将所有的模块实例放入模块列表中</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">msgManager.init</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="built_in">pairs</span>(msgNameList) <span class="keyword">do</span></span><br><span class="line">        <span class="comment">-- 获得Message目录下的所有相关的模块</span></span><br><span class="line">        msgModelList[v] = <span class="built_in">require</span>(<span class="string">&quot;Message.&quot;</span>..v).new();</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>模块获取</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 获取模块实例</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">msgManager.getMsg</span><span class="params">(key)</span></span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> msgModelList[key] <span class="keyword">then</span></span><br><span class="line">        Log.Error(key .. <span class="string">&quot;不存在&quot;</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> msgModelList[key];</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>消息接收</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 接收消息，用于在C# NetManager 中进行调用</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">receiveMsg</span><span class="params">(msgID, msg)</span></span></span><br><span class="line">    Log.Info(<span class="string">&quot;reveived msg id = &quot;</span> .. msgID .. <span class="string">&quot; : &quot;</span> .. msg);</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span>(msgResponses[msgID]) == <span class="string">&quot;function&quot;</span> <span class="keyword">then</span></span><br><span class="line">        msgResponses[msgID](msg);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        Log.Error(msgID .. <span class="string">&quot; 消息不存在回调&quot;</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>消息发送</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 消息发送，调用C# NetManager中方法进行处理</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">msgManager.sendMsg</span><span class="params">(msgID, sendData)</span></span></span><br><span class="line">    <span class="keyword">local</span> str = Json.encode(sendData);</span><br><span class="line">    Log.Info(<span class="string">&quot;send msg id = &quot;</span> .. msgID .. <span class="string">&quot; : &quot;</span> .. str);</span><br><span class="line">    Manager.NetManager:SendMessage(msgID, str);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>简单服务器</p>
<h4 id="热更新框架"><a href="#热更新框架" class="headerlink" title="热更新框架"></a>热更新框架</h4><h5 id="为什么需要更新"><a href="#为什么需要更新" class="headerlink" title="为什么需要更新"></a>为什么需要更新</h5><ol>
<li>修复产品问题</li>
<li>游戏内容扩充/删减</li>
</ol>
<h5 id="热更新是什么"><a href="#热更新是什么" class="headerlink" title="热更新是什么"></a>热更新是什么</h5><ul>
<li><p>普通更新流程</p>
<p><img src="/images/热更新/image-20221119161708686.png" alt="普通更新流程"></p>
<p>需要商店审核，周期长，更新需要重新安装。</p>
</li>
<li><p>热更新流程 </p>
<p><img src="/images/热更新/image-20221119162621384.png" alt="热更新流程 "></p>
<p>不需要商店审核，提交便捷，在游戏内自动完成资源下载和更新</p>
</li>
<li><p>为什么选择LUA</p>
<p>Unity3D        资源热更</p>
<p>C# 编译型语言    脚本打包成动态链接库DLL    </p>
<p>Lua 解释型语言    脚本运行时翻译成机器语言，不需要编译。脚本和资源都可以动态替换 </p>
<p><img src="/images/热更新/image-20221119163531878.png" alt="流程"></p>
</li>
</ul>
<h6 id="Lua热更的几个点"><a href="#Lua热更的几个点" class="headerlink" title="Lua热更的几个点"></a>Lua热更的几个点</h6><ol>
<li>需要导入热更插件（XLua、ToLua、SLua等） 稳定易用，不用重复造轮子</li>
<li>综合考量，划分项目功能结构。 需要频繁更新的部分就采用热性新，即使用Lua脚本实现</li>
<li>编写框架或使用成熟的热更行框架，便于之后开发流程的进行</li>
</ol>
<h5 id="Xlua框架与项目框架"><a href="#Xlua框架与项目框架" class="headerlink" title="Xlua框架与项目框架"></a>Xlua框架与项目框架</h5><p>引入xLua插件， 制定整体架构，选择对应的技术方案</p>
<h6 id="lua框架—主程所考虑的"><a href="#lua框架—主程所考虑的" class="headerlink" title="lua框架—主程所考虑的"></a>lua框架—主程所考虑的</h6><ol>
<li>游戏类型：强联网、若联网</li>
<li>功能划分与Scene场景规划：背包，战斗等</li>
<li>特殊需求</li>
<li>制定模块系统：版本更新检测系统、登录等。C#仅调用lua的主要接口，lua脚本中的功能或操作均在lua中处理</li>
</ol>
<h6 id="中后期项目的热更重构建议"><a href="#中后期项目的热更重构建议" class="headerlink" title="中后期项目的热更重构建议"></a>中后期项目的热更重构建议</h6><ol>
<li>核心数据Lua存储</li>
<li>配置文件挪到Lua</li>
<li>网络交互使用Lua封装和调用</li>
<li>业务功能模块不在绑定C#</li>
<li>每个UI功能使用Lua处理</li>
<li>战斗等复合功能模块，增加辅助Lua处理</li>
<li>原框架核心功能部分改成Lua实现，部分打上LUACALLCSHARP标签</li>
<li>实现Lua模块间的通信。 </li>
</ol>
<h6 id="XLua框架"><a href="#XLua框架" class="headerlink" title="XLua框架"></a>XLua框架</h6><p><img src="/images/热更新/image-20221119183806517.png" alt="Xlua框架执行流程"></p>
<h5 id="框架基本功能"><a href="#框架基本功能" class="headerlink" title="框架基本功能"></a>框架基本功能</h5><h6 id="资源目录结构划分"><a href="#资源目录结构划分" class="headerlink" title="资源目录结构划分"></a>资源目录结构划分</h6><p>以资源类型划分一级目录</p>
<ul>
<li>Custom：用户自定义功能</li>
<li>Font：字体</li>
<li>Module：所有功能模块，每个功能对应Lua脚本</li>
<li>Prefab：预制体</li>
<li>Sound：音效等</li>
<li>Sprite：图片</li>
<li>Texture：纹理</li>
</ul>
<h6 id="功能模块的引用与操作"><a href="#功能模块的引用与操作" class="headerlink" title="功能模块的引用与操作"></a>功能模块的引用与操作</h6><ol>
<li><p>功能预制体资源</p>
<ul>
<li><p>按照功能将模块封装为预制体</p>
</li>
<li><p>存放于Module目录对应的目录下</p>
</li>
<li><p>Tag设置为uiComponent</p>
</li>
</ul>
</li>
<li><p>功能脚本资源</p>
<ul>
<li>功能名.lua （逻辑脚本）<ul>
<li>Create() 加载并创建功能模块预制体</li>
<li>Awake() 完成View脚本的初始化和逻辑脚本初始化</li>
<li>BottonClickHander() 按钮对应方法的调用</li>
</ul>
</li>
<li>功能名View.lua （试图脚本）<ul>
<li>Create() 指向模块路径和模块名</li>
<li>SetUICompenent() 绑定模块下的物体 按钮 图片 预制体</li>
<li>StartInit() 按钮功能监听</li>
</ul>
</li>
</ul>
</li>
</ol>
<h6 id="配置文件的使用"><a href="#配置文件的使用" class="headerlink" title="配置文件的使用"></a>配置文件的使用</h6><h6 id="图片与预制体资源的动态获取"><a href="#图片与预制体资源的动态获取" class="headerlink" title="图片与预制体资源的动态获取"></a>图片与预制体资源的动态获取</h6><h6 id="单机Demo热更新制作规划"><a href="#单机Demo热更新制作规划" class="headerlink" title="单机Demo热更新制作规划"></a>单机Demo热更新制作规划</h6><ol>
<li><p>ARPG游戏DEMO的需求分析</p>
</li>
<li><p>正式确定DEMO的功能模块</p>
<p><img src="/images/热更新/image-20221120171602129.png" alt="功能模块分析"></p>
</li>
<li><p>功能模块与技术支持</p>
<p>功能模块</p>
<p><img src="/images/热更新/image-20221120172833796.png" alt="功能模块需求"></p>
<p>技术支撑</p>
<p><img src="/images/热更新/image-20221120173635985.png" alt="1"></p>
</li>
</ol>
<ol>
<li>准备开发</li>
</ol>
<h5 id="战斗系统分析"><a href="#战斗系统分析" class="headerlink" title="战斗系统分析"></a>战斗系统分析</h5><ol>
<li><p>需求分析</p>
<p><img src="/images/热更新/image-20221217210406239.png" alt="image-20221217210406239"></p>
<ol>
<li>形式：回合制、即时战斗</li>
<li>如何开始：攻击怪物、靠近怪物</li>
<li>如何结束：打败敌人、退出地图</li>
</ol>
</li>
<li><p>配置表与数据结构</p>
<p>需要较为完整的配置表才能更好的进行代码逻辑的编写</p>
<p><img src="/images/热更新/image-20221217210547055.png" alt="image-20221217210547055"></p>
</li>
<li><p>模块支撑</p>
<ol>
<li><p>分析</p>
<p><img src="/images/热更新/image-20221217210712333.png" alt="image-20221217210712333"></p>
<ol>
<li>场景管理：进入战场，场景切换</li>
<li>怪物管理：怪物刷新、怪物相关任务</li>
<li>战斗计算：战斗过程处理</li>
<li>战斗结算：进行结算</li>
<li>战斗动画：管理动画</li>
<li>特效管理：管理特效</li>
</ol>
</li>
<li><p>普攻实现</p>
<ol>
<li>攻击距离</li>
<li>攻击判定</li>
<li>攻击力动态计算</li>
<li>数值与公式</li>
</ol>
</li>
<li><p>技能实现</p>
<ol>
<li>回复术：回复生命值/魔法值等（对Player属性的修改）</li>
<li>buff：存在时间，可以对多种属性进行增益或减益</li>
<li>火球术：伤害类技能，直接碰撞检测等 </li>
</ol>
</li>
</ol>
</li>
</ol>
<h5 id="网游功能模块分析"><a href="#网游功能模块分析" class="headerlink" title="网游功能模块分析"></a>网游功能模块分析</h5><ol>
<li><p>模块分析</p>
<p><img src="/images/热更新/image-20221218151849593.png" alt="image-20221218151849593"></p>
</li>
<li><p>框架技术</p>
<p><img src="/images/热更新/image-20221218152309588.png" alt="image-20221218152309588"></p>
</li>
<li><p>网络请求</p>
<p><img src="/images/热更新/image-20221218155737845.png" alt="image-20221218155737845"></p>
</li>
</ol>
<h6 id="网络模块分析"><a href="#网络模块分析" class="headerlink" title="网络模块分析"></a>网络模块分析</h6><ol>
<li>Net模块工作原理</li>
<li>Net模块功能分析</li>
<li>Net模块使用操作</li>
</ol>
<ul>
<li>短链接<ul>
<li>缺点：连接操作频繁</li>
<li>优点：服务器管理成本低，对服务器压力小</li>
</ul>
</li>
<li>C#端与Http请求回调<ul>
<li>IP地址问题</li>
<li>接收Lua回调方法</li>
<li>使用Post请求</li>
<li>响应后将回调方法加入C#CallLua列表</li>
</ul>
</li>
</ul>
<h6 id="一次业务请求逻辑流程"><a href="#一次业务请求逻辑流程" class="headerlink" title="一次业务请求逻辑流程"></a>一次业务请求逻辑流程</h6><ol>
<li><p>方式一</p>
<p><img src="/images/热更新/image-20221220142727994.png" alt="image-20221220142727994"></p>
</li>
<li><p>方式二：主数据的 更新交给框架处理，不需要再业务逻辑开发的过程中处理</p>
<p><img src="/images/热更新/image-20221220143029015.png" alt="image-20221220143029015"></p>
</li>
</ol>
<h6 id="背包模块分析"><a href="#背包模块分析" class="headerlink" title="背包模块分析"></a>背包模块分析</h6><p>​    <img src="/images/热更新/image-20221220185056104.png" alt="image-20221220185056104"></p>
<ol>
<li>需求分析 <ol>
<li>滑动列表多物体处理：只显示框内的物体，对在列表外的物体进行隐藏</li>
</ol>
</li>
<li>数据流</li>
<li>数据结构</li>
<li>配置文件</li>
</ol>
<h6 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h6><p><img src="/images/热更新/image-20221220210827243.png" alt="image-20221220210827243"></p>
<h5 id="框架概念"><a href="#框架概念" class="headerlink" title="框架概念"></a>框架概念</h5><h6 id="框架目标"><a href="#框架目标" class="headerlink" title="框架目标"></a>框架目标</h6><p><img src="/images/热更新/image-20221221164620711.png" alt="image-20221221164620711"></p>
<ol>
<li><p>可靠性</p>
<ul>
<li>bug为什么多</li>
<li>公共功能架构解决</li>
</ul>
</li>
<li><p>安全性</p>
<ul>
<li>核心是数据安全</li>
<li>加密</li>
<li>身份验证</li>
<li>只相信服务器的运算 </li>
</ul>
</li>
<li><p>可扩展和和维护</p>
<p>功能和功能之间需要进行合理的划分，之间不能直接进行调用，要方便后续的功能开发</p>
<ul>
<li>功能不断增加</li>
<li>功能需要维护</li>
<li>功能划分</li>
<li>松耦合</li>
</ul>
</li>
<li><p>可定制和可伸缩</p>
<ul>
<li>可根据需求进行调整：不同项目侧重不同——框架扩充</li>
<li>可根据新技术对现有框架进行扩展</li>
<li>不同项目自定义模块方法</li>
<li>lua插件本体也可以更换</li>
</ul>
</li>
<li><p>客户体验</p>
<p>方便开发</p>
<ul>
<li>开发模板</li>
<li>开发工具 ：配置文件等</li>
</ul>
</li>
</ol>
<h6 id="为什么需要热更框架"><a href="#为什么需要热更框架" class="headerlink" title="为什么需要热更框架"></a>为什么需要热更框架</h6><ol>
<li><p>被动因素</p>
<ul>
<li>XLua：和Tween/easyTouch等插件不一样，使用的是lua语言进行项目开发，从根本上改变了原有框架</li>
</ul>
</li>
<li><p><img src="/images/热更新/image-20221221230049180.png" alt="image-20221221230049180"></p>
</li>
</ol>
<h6 id="热更框架目标"><a href="#热更框架目标" class="headerlink" title="热更框架目标"></a>热更框架目标</h6><ol>
<li>引擎部分</li>
</ol>
<p>   <img src="/images/热更新/image-20221221230854494.png" alt="image-20221221230854494"></p>
<ul>
<li>内部采用打包时间作为版本号</li>
</ul>
<ol>
<li><p>C#部分</p>
<p><img src="/images/热更新/image-20221221232227664.png" alt="image-20221221232227664"></p>
</li>
<li><p>Lua部分：使代码功能模式化  </p>
<p><img src="/images/热更新/image-20221221233018384.png" alt="image-20221221233018384"></p>
</li>
</ol>
<h5 id="框架结构"><a href="#框架结构" class="headerlink" title="框架结构"></a>框架结构</h5><h6 id="框架项目目录结构"><a href="#框架项目目录结构" class="headerlink" title="框架项目目录结构"></a>框架项目目录结构</h6><ol>
<li><img src="/images/热更新/image-20221222162432848.png" alt="image-20221222162432848"><ul>
<li>Ant：自定义组件C#脚本</li>
<li>AssetBundlesLocal：热更新资源目录</li>
<li>Editor：编辑器开发目录</li>
<li>EditorPrefab：自定义组件预制体</li>
<li>Lua：lua脚本存放目录</li>
<li>Plugins：插件目录</li>
<li>Resources：内部资源目录</li>
<li>Xlua：xlua插件目录</li>
</ul>
</li>
</ol>
<h6 id="重点功能模块"><a href="#重点功能模块" class="headerlink" title="重点功能模块"></a>重点功能模块</h6><p><img src="/images/热更新/image-20221222190624759.png" alt="image-20221222190624759"></p>
<h6 id="功能模块调用关系"><a href="#功能模块调用关系" class="headerlink" title="功能模块调用关系"></a>功能模块调用关系</h6><p><img src="/images/热更新/image-20221222190725350.png" alt="image-20221222190725350"></p>
<ul>
<li><p>重点功能模块</p>
<ul>
<li><p>UIGameLoading</p>
<p><img src="/images/热更新/image-20221222191306345.png" alt="image-20221222191306345"></p>
</li>
<li><p>AppBoot</p>
<p><img src="/images/热更新/image-20221222191735997.png" alt="image-20221222191735997"></p>
</li>
<li><p>LuaTools</p>
<p><img src="/images/热更新/image-20221222192558778.png" alt="image-20221222192558778"></p>
</li>
<li><p>LuaBehaviour</p>
<p><img src="/images/热更新/image-20221222193754710.png" alt="image-20221222193754710"></p>
</li>
<li><p>ResourceManager</p>
<p><img src="/images/热更新/image-20221222194608256.png" alt="image-20221222194608256"></p>
</li>
<li><p>SystemTool</p>
<p><img src="/images/热更新/image-20221222195018653.png" alt="image-20221222195018653"></p>
</li>
</ul>
</li>
<li><p>重点脚本</p>
<ul>
<li><p>ui.lua</p>
<p><img src="/images/热更新/image-20221222195137140.png" alt="image-20221222195137140"></p>
</li>
<li><p>main.lua</p>
<p><img src="/images/热更新/image-20221222195215642.png" alt="image-20221222195215642"></p>
</li>
<li><p>网络模块</p>
<p><img src="/images/热更新/image-20221222195944179.png" alt="image-20221222195944179"></p>
</li>
<li><p>list.lua</p>
<p><img src="/images/热更新/image-20221222200020222.png" alt="image-20221222200020222"></p>
</li>
<li><p>GameMainData</p>
<p><img src="/images/热更新/image-20221222200037417.png" alt="image-20221222200037417"></p>
</li>
<li><p>event.lua</p>
<p>事件系统，可以订阅和调用</p>
<p><img src="/images/热更新/image-20221222200306912.png" alt="image-20221222200306912"></p>
</li>
<li><p>plugin.lua</p>
<p>插件资源管理，方便管理</p>
<p><img src="/images/热更新/image-20221222200444582.png" alt="image-20221222200444582"></p>
</li>
<li><p>public.lua</p>
<p>公共资源管理，存放公共方法</p>
<p><img src="/images/热更新/image-20221222200455483.png" alt="image-20221222200455483"></p>
</li>
<li><p>tools.lua</p>
<p><img src="/images/热更新/image-20221222200902127.png" alt="image-20221222200902127"></p>
</li>
</ul>
</li>
</ul>
<h5 id="框架功能设计"><a href="#框架功能设计" class="headerlink" title="框架功能设计"></a>框架功能设计</h5><ol>
<li><p>业务功能管理 </p>
<ul>
<li><p>ui.lua</p>
<p><img src="/images/热更新/image-20230106085705394.png" alt="image-20230106085705394"></p>
</li>
<li><p>UIGameLoading</p>
<p><img src="/images/热更新/image-20230106145150649.png" alt="image-20230106145150649"></p>
</li>
</ul>
</li>
<li><p>网络请求管理 </p>
<ul>
<li><p>net.lua</p>
<p><img src="/images/热更新/image-20230106101826176.png" alt="image-20230106101826176"></p>
</li>
<li></li>
</ul>
</li>
</ol>
<h5 id="资源打包策略"><a href="#资源打包策略" class="headerlink" title="资源打包策略"></a>资源打包策略</h5><ol>
<li><p>资源打包前提</p>
<p><img src="/images/热更新/image-20230204220246369.png" alt="image-20230204220246369"></p>
</li>
<li><p>资源打包流程</p>
<p><img src="/images/热更新/image-20230205142823955.png" alt="image-20230205142823955"></p>
</li>
<li><p>资源打包策略</p>
<p><img src="/images/热更新/image-20230205144440952.png" alt="image-20230205144440952"></p>
<p><img src="/images/热更新/image-20230205145249992.png" alt="image-20230205145249992"></p>
</li>
<li><p>相关类和函数</p>
<p>AssetImporter：</p>
<p><strong>属性</strong></p>
<ul>
<li>assetBundleName / assetBundleVariant：获取或设置AssetBundle Name / Property；</li>
</ul>
<p><strong>静态方法</strong></p>
<ul>
<li>GetAtPath()：通过静态方法GetAtPath获取指定路径（相对路径）下的资源的导入器</li>
</ul>
</li>
</ol>
<h5 id="资源管理策略"><a href="#资源管理策略" class="headerlink" title="资源管理策略"></a>资源管理策略</h5><ol>
<li><p>ab包加载</p>
<ol>
<li><p>编辑器开发</p>
<p>使用unity资源数据库类管理</p>
<p><code>AssetDatabase.LoadAssetAtPath&lt;AudioClip&gt;(&quot;Assets/AssetBundlesLocal/&quot; + path + &quot;/&quot; + name + &quot;.wav&quot;)</code></p>
</li>
<li><p>真机环境(PC、安卓)</p>
<ul>
<li>判断内存中是否加载需要的资源</li>
<li>若不存在相应资源，则判断是否存在对应的ab包</li>
<li>若存在，则从ab包中读取对应的资源</li>
<li>若不存在，则先load这个ab包，放入对应容器，然后加载资源</li>
</ul>
</li>
<li><p>优点</p>
<ol>
<li>可以避免重复加载同一个ab包</li>
<li>每一个资源都不会重复加载</li>
<li>通过ab包名和资源名就可以获取相应的资源。ab包名对应路径</li>
</ol>
</li>
<li><p>ab包加载路径</p>
<ol>
<li><p>真机</p>
<p>在从资源服务器判断热更后，下载ab包，将其存放在客户端的PersistentData目录下</p>
</li>
<li><p>编辑器</p>
<p>要将ab包复制到PersistentData目录下</p>
</li>
</ol>
</li>
<li><p>预加载资源</p>
<p>有一些资源需要在运行前加载到内存中</p>
<p>有些资源需要在某功能开始前加载</p>
<ol>
<li><p>依赖关系</p>
<p>一个预制体，使用了text，text使用了字体</p>
<p>字体和预制体都被打包未ab包</p>
<p>则这个预制体ab依赖于字体的ab</p>
<p>要使用这个预制体，则需要预加载字体ab</p>
<ul>
<li>按照功能划分ab包，一个功能的所有依赖都打包到同一个ab包中</li>
<li>公共部分打包为公共ab包，所有使用它的模块共同依赖这个ab包</li>
</ul>
</li>
<li><p>预加载常驻内存资源</p>
<ul>
<li>提供加载方法，一般用于字体，shader等资源</li>
</ul>
</li>
<li><p>预加载模块资源</p>
</li>
</ol>
</li>
<li><p>资源维护与清理</p>
<ol>
<li>维护<ol>
<li>allAssetBundle[path] ：存储所有ab包的容器（字典），每一个ab在内存中的引用。ab包被清理后，对应的值也会被清理</li>
<li>ab.Unload(true)：清理ab包，并清理ab包中每一个资源的引用</li>
<li>ab.Unload(false)：仅清理ab包，不清理资源的引用。可能会导致内存泄露</li>
</ol>
</li>
<li>清理<ol>
<li>C#端，判断内存中是否存在ab包，存在则Unload</li>
<li>lua端根据需要的时候调用</li>
</ol>
</li>
</ol>
</li>
<li><p>资源清理策略</p>
<ol>
<li><p>如何清理</p>
<p>调用清理方法</p>
</li>
<li><p>调用时机</p>
<ol>
<li><p>功能模块关闭后直接调用清理</p>
<p>对于ab包容量不大，资源数适中，在load时不卡顿</p>
</li>
<li><p>根据实际情况决定时机</p>
<p>对于ab包容量大，资源数较多，load时有卡顿</p>
</li>
</ol>
</li>
<li><p>策略一：从源头</p>
<ol>
<li>在ab包划分时：功能划分，资源划分，公共资源部分确定（常驻）</li>
<li>资源本生容量控制：在显示效果牺牲不大的情况下降低资源配置</li>
</ol>
</li>
<li><p>二：补救，通过配置文件决定如何清理</p>
<ol>
<li>延迟清理：在模块关闭一定时间后再清理</li>
<li>根据需要<ol>
<li>时间段：某个时间段内不清理</li>
<li>等级：某些等级对某些模块的使用更频繁</li>
<li>其他：vip、等</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<h5 id="开发工具设计"><a href="#开发工具设计" class="headerlink" title="开发工具设计"></a>开发工具设计</h5><ol>
<li><p>编译器工具</p>
<p>通过自定义扩展编辑器功能</p>
</li>
<li><p>常规工具</p>
<p>独立运行的exe程序</p>
</li>
<li><p>准换工具</p>
<p>json转换为lua</p>
<p>excel转换为json</p>
</li>
</ol>

            </div>
            
                <div class="kratos-copyright text-center clearfix">
                    <h5>本作品采用 <a rel="license nofollow" target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">知识共享署名-相同方式共享 4.0 国际许可协议</a> 进行许可</h5>
                </div>
            
            <footer class="kratos-entry-footer clearfix">
                
                    <div class="post-like-donate text-center clearfix" id="post-like-donate">
                    
                    
                        <a class="share" href="javascript:;"><i class="fa fa-share-alt"></i> 分享</a>
                        <div class="share-wrap" style="display: none;">
    <div class="share-group">
        <a href="javascript:;" class="share-plain qq" onclick="share('qq');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-qq"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain qzone" onclick="share('qzone');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-star"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain weixin pop style-plain" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-weixin"></i>
            </div>
            <div class="share-int">
                <div class="qrcode" id="wechat-qr"></div>
                <p>打开微信“扫一扫”，打开网页后点击屏幕右上角分享按钮</p>
            </div>
        </a>
        <a href="javascript:;" class="share-plain weibo" onclick="share('weibo');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-weibo"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain facebook style-plain" onclick="share('facebook');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-facebook"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain twitter style-plain" onclick="share('twitter');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-twitter"></i>
            </div>
        </a>
    </div>
    <script type="text/javascript">
        $(()=>{
            new QRCode("wechat-qr", {
                text: "http://kennyyyyyy.github.io/2022/08/16/%E7%83%AD%E6%9B%B4%E6%96%B0/",
                width: 150,
                height: 150,
                correctLevel : QRCode.CorrectLevel.H
            });
        });
        function share(dest) {
            const qqBase        = "https://connect.qq.com/widget/shareqq/index.html?";
            const weiboBase     = "https://service.weibo.com/share/share.php?";
            const qzoneBase     = "https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?";
            const facebookBase  = "https://www.facebook.com/sharer/sharer.php?";
            const twitterBase   = "https://twitter.com/intent/tweet?";
            const hostUrl       = "http://kennyyyyyy.github.io/2022/08/16/%E7%83%AD%E6%9B%B4%E6%96%B0/";
            const title         = "「热更新（XLua框架）」";
            const excerpt       = `

资源目录划分
框架内容
Lua

UI

实体（模型，特效）

场景

声音

网络

事件

对象池


框架开发流程第一阶段：Bundle处理
构建

查找BuildResources下的资源文件

使用Unity提供的Bui...`;
            let _URL;
            switch (dest) {
                case "qq"       : _URL = qqBase+"url="+hostUrl+"&title="+title+"&desc=&summary="+excerpt+"&site=cxpy";     break;
                case "weibo"    : _URL = weiboBase+"url="+hostUrl+"&title="+title+excerpt;                                 break;
                case "qzone"    : _URL = qzoneBase+"url="+hostUrl+"&title="+title+"&desc=&summary="+excerpt+"&site=cxpy";  break;
                case "facebook" : _URL = facebookBase+"u="+hostUrl;                                                        break;
                case "twitter"  : _URL = twitterBase+"text="+title+excerpt+"&url="+hostUrl;                                break;
            }
            window.open(_URL);
        };
    </script>
</div>
                    
                    </div>
                
                <div class="footer-tag clearfix">
                    <div class="pull-left">
                    <i class="fa fa-tags"></i>
                        <a class="tag-none-link" href="/tags/C/" rel="tag">C#</a>, <a class="tag-none-link" href="/tags/Lua/" rel="tag">Lua</a>, <a class="tag-none-link" href="/tags/Unity/" rel="tag">Unity</a>, <a class="tag-none-link" href="/tags/xlua/" rel="tag">xlua</a>
                    </div>
                    <div class="pull-date">
                    <span>最后编辑：2023-02-09</span>
                    </div>
                </div>
            </footer>
        </div>
        
            <nav class="navigation post-navigation clearfix" role="navigation">
                
                <div class="nav-previous clearfix">
                    <a title=" Lua学习" href="/2022/08/12/Lua学习/">&lt; 上一篇</a>
                </div>
                
                
                <div class="nav-next clearfix">
                    <a title=" 知识点记录(Unity/C#)" href="/2022/08/19/知识点记录/">下一篇 &gt;</a>
                </div>
                
            </nav>
        
        
    </article>
</section>

                
            

<section id="kratos-widget-area" class="col-md-4 hidden-xs hidden-sm">
    <!-- 文章和页面根据splitter来分割，没有的话就从头开始设置为sticky -->
    
    
                <aside id="krw-about" class="widget widget-kratos-about clearfix">
    <div class="photo-background"></div>
    <div class="photo-wrapper clearfix">
        <div class="photo-wrapper-tip text-center">
            <img class="about-photo" src="/images/avatar.jpg" />
        </div>
    </div>
    <div class="textwidget">
        <p class="text-center">Deep♂ Dark♂ Fantasy♂</p>
    </div>
</aside>
            
                    <div class="sticky-area">
                
                    <aside id="krw-toc" class="widget widget-kratos-toc clearfix">
    <div class="photo-background"></div>
    <h4 class="widget-title no-after">
        <i class="fa fa-compass"></i>
        文章目录
        <span class="toc-progress-bar"></span>
    </h4>
    <div class="textwidget">
        <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E7%9B%AE%E5%BD%95%E5%88%92%E5%88%86"><span class="toc-text">资源目录划分</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%86%E6%9E%B6%E5%86%85%E5%AE%B9"><span class="toc-text">框架内容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%86%E6%9E%B6%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B"><span class="toc-text">框架开发流程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5%EF%BC%9ABundle%E5%A4%84%E7%90%86"><span class="toc-text">第一阶段：Bundle处理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5%EF%BC%9AC-%E8%B0%83%E7%94%A8Lua"><span class="toc-text">第二阶段：C#调用Lua</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5%EF%BC%9A%E5%90%91Lua%E6%8F%90%E4%BE%9B%E6%8E%A5%E5%8F%A3"><span class="toc-text">第三阶段：向Lua提供接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E9%98%B6%E6%AE%B5%EF%BC%9A%E5%AE%8C%E5%96%84%E5%92%8C%E4%BC%98%E5%8C%96"><span class="toc-text">第四阶段：完善和优化</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#UI%E7%AE%A1%E7%90%86"><span class="toc-text">UI管理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9E%E4%BD%93%E7%AE%A1%E7%90%86"><span class="toc-text">实体管理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF%E7%AE%A1%E7%90%86"><span class="toc-text">场景管理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A3%B0%E9%9F%B3%E7%AE%A1%E7%90%86"><span class="toc-text">声音管理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E7%AE%A1%E7%90%86"><span class="toc-text">事件管理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E6%B1%A0%E8%AE%BE%E8%AE%A1"><span class="toc-text">对象池设计</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9D%97"><span class="toc-text">网络模块</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%83%AD%E6%9B%B4%E6%96%B0%E6%A1%86%E6%9E%B6"><span class="toc-text">热更新框架</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E6%9B%B4%E6%96%B0"><span class="toc-text">为什么需要更新</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%83%AD%E6%9B%B4%E6%96%B0%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">热更新是什么</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Lua%E7%83%AD%E6%9B%B4%E7%9A%84%E5%87%A0%E4%B8%AA%E7%82%B9"><span class="toc-text">Lua热更的几个点</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Xlua%E6%A1%86%E6%9E%B6%E4%B8%8E%E9%A1%B9%E7%9B%AE%E6%A1%86%E6%9E%B6"><span class="toc-text">Xlua框架与项目框架</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#lua%E6%A1%86%E6%9E%B6%E2%80%94%E4%B8%BB%E7%A8%8B%E6%89%80%E8%80%83%E8%99%91%E7%9A%84"><span class="toc-text">lua框架—主程所考虑的</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%AD%E5%90%8E%E6%9C%9F%E9%A1%B9%E7%9B%AE%E7%9A%84%E7%83%AD%E6%9B%B4%E9%87%8D%E6%9E%84%E5%BB%BA%E8%AE%AE"><span class="toc-text">中后期项目的热更重构建议</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#XLua%E6%A1%86%E6%9E%B6"><span class="toc-text">XLua框架</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%86%E6%9E%B6%E5%9F%BA%E6%9C%AC%E5%8A%9F%E8%83%BD"><span class="toc-text">框架基本功能</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E5%88%92%E5%88%86"><span class="toc-text">资源目录结构划分</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97%E7%9A%84%E5%BC%95%E7%94%A8%E4%B8%8E%E6%93%8D%E4%BD%9C"><span class="toc-text">功能模块的引用与操作</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">配置文件的使用</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%9B%BE%E7%89%87%E4%B8%8E%E9%A2%84%E5%88%B6%E4%BD%93%E8%B5%84%E6%BA%90%E7%9A%84%E5%8A%A8%E6%80%81%E8%8E%B7%E5%8F%96"><span class="toc-text">图片与预制体资源的动态获取</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8D%95%E6%9C%BADemo%E7%83%AD%E6%9B%B4%E6%96%B0%E5%88%B6%E4%BD%9C%E8%A7%84%E5%88%92"><span class="toc-text">单机Demo热更新制作规划</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%88%98%E6%96%97%E7%B3%BB%E7%BB%9F%E5%88%86%E6%9E%90"><span class="toc-text">战斗系统分析</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BD%91%E6%B8%B8%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97%E5%88%86%E6%9E%90"><span class="toc-text">网游功能模块分析</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9D%97%E5%88%86%E6%9E%90"><span class="toc-text">网络模块分析</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%80%E6%AC%A1%E4%B8%9A%E5%8A%A1%E8%AF%B7%E6%B1%82%E9%80%BB%E8%BE%91%E6%B5%81%E7%A8%8B"><span class="toc-text">一次业务请求逻辑流程</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%83%8C%E5%8C%85%E6%A8%A1%E5%9D%97%E5%88%86%E6%9E%90"><span class="toc-text">背包模块分析</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%86%E6%9E%B6%E6%A6%82%E5%BF%B5"><span class="toc-text">框架概念</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%A1%86%E6%9E%B6%E7%9B%AE%E6%A0%87"><span class="toc-text">框架目标</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E7%83%AD%E6%9B%B4%E6%A1%86%E6%9E%B6"><span class="toc-text">为什么需要热更框架</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%83%AD%E6%9B%B4%E6%A1%86%E6%9E%B6%E7%9B%AE%E6%A0%87"><span class="toc-text">热更框架目标</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%86%E6%9E%B6%E7%BB%93%E6%9E%84"><span class="toc-text">框架结构</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%A1%86%E6%9E%B6%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-text">框架项目目录结构</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%87%8D%E7%82%B9%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97"><span class="toc-text">重点功能模块</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97%E8%B0%83%E7%94%A8%E5%85%B3%E7%B3%BB"><span class="toc-text">功能模块调用关系</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A1%86%E6%9E%B6%E5%8A%9F%E8%83%BD%E8%AE%BE%E8%AE%A1"><span class="toc-text">框架功能设计</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E6%89%93%E5%8C%85%E7%AD%96%E7%95%A5"><span class="toc-text">资源打包策略</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E7%AD%96%E7%95%A5"><span class="toc-text">资源管理策略</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E8%AE%BE%E8%AE%A1"><span class="toc-text">开发工具设计</span></a></li></ol></li></ol>
    </div>
</aside>
                
                
  <aside id="krw-categories" class="widget widget-kratos-categories clearfix">
    <h4 class="widget-title"><i class="fa fa-folder"></i>分类目录</h4>
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Unity/">Unity</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/c/">c++</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AD%A6%E4%B9%A0/">学习</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/">每日一题</a><span class="category-list-count">1</span></li></ul>
  </aside>


            
                
  <aside id="krw-tags" class="widget widget-kratos-tags clearfix">
    <h4 class="widget-title"><i class="fa fa-tags"></i>标签聚合</h4>
      <div class="tag-clouds">
        <a href="/tags/C/" style="font-size: 0.73em;">C#</a> <a href="/tags/C/" style="font-size: 0.6em;">C++</a> <a href="/tags/C-C/" style="font-size: 0.6em;">C/C++</a> <a href="/tags/Leetcode/" style="font-size: 0.6em;">Leetcode</a> <a href="/tags/Linux/" style="font-size: 0.6em;">Linux</a> <a href="/tags/Lua/" style="font-size: 0.67em;">Lua</a> <a href="/tags/Socket/" style="font-size: 0.6em;">Socket</a> <a href="/tags/Unity/" style="font-size: 0.8em;">Unity</a> <a href="/tags/c/" style="font-size: 0.6em;">c++</a> <a href="/tags/unity/" style="font-size: 0.67em;">unity</a> <a href="/tags/xlua/" style="font-size: 0.6em;">xlua</a> <a href="/tags/%E5%9B%BE%E5%BD%A2%E5%AD%A6/" style="font-size: 0.6em;">图形学</a> <a href="/tags/%E5%AD%A6%E4%B9%A0/" style="font-size: 0.6em;">学习</a> <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 0.6em;">操作系统</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 0.6em;">数据库</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 0.6em;">数据结构</a> <a href="/tags/%E7%BB%8F%E9%AA%8C/" style="font-size: 0.67em;">经验</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 0.6em;">计算机网络</a>
      </div>
  </aside>

            
                
  <aside id="krw-posts" class="widget widget-kratos-posts">
  <h4 class="widget-title"><i class="fa fa-file"></i>最新文章</h4>
  <div class="tab-content">
      <ul class="list-group">
        
        
          
          
            <a class="list-group-item" href="/2023/08/05/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%9F%BA%E7%A1%80/"><i class="fa  fa-book"></i> 嵌入式基础</a>
            
          
        
          
          
            <a class="list-group-item" href="/2022/12/06/%E6%AF%95%E8%AE%BE%E8%AE%B0%E5%BD%95/"><i class="fa  fa-book"></i> 毕设记录</a>
            
          
        
          
          
            <a class="list-group-item" href="/2022/11/21/Unity%E5%8A%9F%E8%83%BD%E6%A8%A1%E5%9D%97%E6%95%B4%E7%90%86/"><i class="fa  fa-book"></i> Unity功能模块整理</a>
            
          
        
          
          
            <a class="list-group-item" href="/2022/11/06/Unity%E7%9B%B8%E5%85%B3/"><i class="fa  fa-book"></i> Unity相关</a>
            
          
        
          
          
            <a class="list-group-item" href="/2022/10/07/3D%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80%EF%BC%9A%E5%9B%BE%E5%BD%A2%E4%B8%8E%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/"><i class="fa  fa-book"></i> 3D数学基础：图形与游戏开发</a>
            
          
        
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
      </ul>
  </div>
  </aside>

            
    </div>
</section>
        
        </div>
    </div>
</div>
<footer>
    <div id="footer"  >
        <div class="kr-tool text-center">
            <div class="tool">
                
                    <div class="box search-box">
                        <a href="/search/">
                            <span class="fa fa-search"></span>
                        </a>
                    </div>
                
                
                    <div class="box theme-box" id="darkmode-switch">
                        <span class="fa fa-adjust"></span>
                    </div>
                
                
            </div>
            <div class="box gotop-box">
                <span class="fa fa-chevron-up"></span>
            </div>
        </div>
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-md-offset-3 footer-list text-center">
                    <ul class="kratos-social-icons">
                        
                        
                        
                        
                        
                        
                        
                        
                        
                    </ul>
                    <ul class="kratos-copyright">
                        <div>
                            <li>&copy; 2023 Imperio 版权所有.</li>
                            <li>本站已运行<span id="span_dt">Loading...</span></li>
                        </div>
                        <div>
                            <li>Theme <a href="https://github.com/Candinya/Kratos-Rebirth" target="_blank">Kratos:Rebirth</a></li>
                            <li>Site built with&nbsp;<i class="fa fa-heart throb" style="color:#d43f57"></i>&nbsp;by kennyyy.</li>
                        </div>
                        <div>
                            <li>Powered by <a href="https://hexo.io" target="_blank" rel="nofollow">Hexo</a></li>
                            <li>Hosted on <a href="https://github.io" target="_blank">Github Pages</a></li>
                        </div>
                        <div>
                            
                            
                        </div>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</footer>
</div>
</div>

        <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.4/dist/js/bootstrap.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.js"></script>
<script>const notMobile = (!(navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)));</script>

<script async src="/js/candy.min.js"></script>


    <script defer src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

<script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script>
<script defer src="/js/kratosr.min.js"></script>
<script defer src="/js/pjax.min.js"></script>


    <script defer src="/js/kr-dark.min.js"></script>



<!-- Extra support for third-party plguins  -->


    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
//<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>